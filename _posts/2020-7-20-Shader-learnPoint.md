---
layout:     post
title:      "Shader知识点"
subtitle:   "这背景图片真好看"
date:       2020-7-20
author:     "Burt"
header-img: "img/in-post/Shader/Shader-bg.jpg"
tags:
    - Shader
    - Unity
---






## 前言

Shader各类语义很多，用到了许多知识，但是当你实现了效果，然鹅不知道为什么会这样，那就很尴尬，有囫囵吞枣的感觉，这一次梳理一下我在编写Shader代码时遇到的语义及其知识点。





## 知识点



### 一、语义

#### 1.SV_POSITION与POSITION

- SV 是 System Value的意思
- POSITION 顶点的坐标
- SV_POSITION 是默认固定的系统值，不得改变

#### 2.SV_Target与Color

- COLOR 顶点颜色
- SV_TARGET 是系统值，表示该函数返回的是用于下一个阶段OutPut Merger的颜色值，这里只简单的做了颜色值得传递。

#### 3.ZWRITE && ZTEST

- ZWRITE表示是否将**深度**写入GBuffer中
- ZTEST表示是否将**颜色**写入GBUFFER中

ZTEST将要渲染物体的深度与ZWRITE中写入的深度进行比较，符合要求则渲染，不符合则不渲染

#### 4.Queue标签

定义渲染顺序，值较大的靠后渲染，值较小的靠前渲染。预定义的值为：

1. Background（1000） 最早被渲染的物体的队列。
2. Geometry    （2000） 不透明物体的渲染队列。大多数物体都应该使用该队列进行渲染，也是Unity Shader中默认的渲染队列。
3. AlphaTest    （2450） 有透明通道，需要进行Alpha Test的物体的队列，比在Geomerty中更有效。
4. Transparent（3000） 半透物体的渲染队列。一般是不写深度的物体，Alpha Blend等的在该队列渲染。
5. Overlay        （4000） 最后被渲染的物体的队列，一般是覆盖效果，比如镜头光晕，屏幕贴片之类的。
6. 用户可以定义任意值，比如”Queue”=”Geometry+10” 



### 二、基本概念

#### 1.什么是深度？

 深度其实就是该像素点在3d世界中距离摄像机的距离。离摄像机越远，则深度值（Z值）越大。

#### 2.什么是深度缓存？

深度缓存中存储着准备要绘制在屏幕上的像素点的深度值。如果启用了深度缓冲区，在绘制每个像素之前，OpenGL会把该像素的深度值和深度缓存的深度值进行比较。如果 新像素深度值 < 深度缓存深度值，则新像素值会取代原先的；反之，新像素值被遮挡，其颜色值和深度将被丢弃。

#### 3.为什么法线贴图都是蓝色的

法线贴图中存储的是切线空间的法线。而法线贴图所对应的表面，绝大部分的位置肯定是平滑的，只有需要凹凸变化的地方才会有变化，那么大部分地方的法线方向不变，也就是在切线空间的（0,0,1），这个值按照上面介绍的映射关系，从（-1,1）区间变换到（0,1）区间：（0*0.5+0.5,0*0.5+0.5,1*0.5+0.5）= （0.5,0.5,1），再转化为颜色的（0,255）区间，最终就变成了（127,127,255）这个颜色即为法线贴图的颜色。





## References

1. <https://blog.csdn.net/qq_29579137/article/details/84486003>
2. <https://zhuanlan.zhihu.com/p/79800363>
3. <https://blog.csdn.net/puppet_master/article/details/53900568>









待续...

